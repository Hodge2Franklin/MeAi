<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MeAI Next Phase</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <div class="logo">MeAI</div>
        <nav>
            <ul>
                <li><a href="#" class="active">Home</a></li>
                <li><a href="test-environment.html">Test Environment</a></li>
            </ul>
        </nav>
    </header>
    
    <main>
        <div class="container">
            <div class="meai-interface">
                <div class="visualization-area">
                    <div id="dynamic-background" class="dynamic-background"></div>
                    <div id="pixel-container" class="pixel-container">
                        <div id="meai-pixel" class="meai-pixel"></div>
                    </div>
                </div>
                
                <div class="conversation-area">
                    <div id="conversation-history" class="conversation-history"></div>
                    
                    <div class="input-area">
                        <input type="text" id="user-input" placeholder="Type your message..." aria-label="Type your message">
                        <button id="send-button" aria-label="Send message">
                            <svg viewBox="0 0 24 24" width="24" height="24">
                                <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path>
                            </svg>
                        </button>
                        <button id="voice-input-button" aria-label="Voice input">
                            <svg viewBox="0 0 24 24" width="24" height="24">
                                <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.91-3c-.49 0-.9.36-.98.85C16.52 14.2 14.47 16 12 16s-4.52-1.8-4.93-4.15c-.08-.49-.49-.85-.98-.85-.61 0-1.09.54-1 1.14.49 3 2.89 5.35 5.91 5.78V20c0 .55.45 1 1 1s1-.45 1-1v-2.08c3.02-.43 5.42-2.78 5.91-5.78.1-.6-.39-1.14-1-1.14z"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="controls-panel">
                <div class="panel-section">
                    <h3>Theme</h3>
                    <div class="theme-selector">
                        <button class="theme-button" data-theme="default">Default</button>
                        <button class="theme-button" data-theme="dark">Dark</button>
                        <button class="theme-button" data-theme="light">Light</button>
                        <button class="theme-button" data-theme="cosmic">Cosmic</button>
                        <button class="theme-button" data-theme="nature">Nature</button>
                    </div>
                </div>
                
                <div class="panel-section">
                    <h3>Accessibility</h3>
                    <div class="accessibility-options">
                        <label>
                            <input type="checkbox" id="high-contrast-toggle">
                            High Contrast
                        </label>
                        <label>
                            <input type="checkbox" id="large-text-toggle">
                            Large Text
                        </label>
                        <label>
                            <input type="checkbox" id="reduced-motion-toggle">
                            Reduced Motion
                        </label>
                        <div class="select-wrapper">
                            <label for="color-blind-mode">Color Blind Mode:</label>
                            <select id="color-blind-mode">
                                <option value="none">None</option>
                                <option value="deuteranopia">Deuteranopia</option>
                                <option value="protanopia">Protanopia</option>
                                <option value="tritanopia">Tritanopia</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="panel-section">
                    <h3>Audio</h3>
                    <div class="audio-controls">
                        <div class="volume-control">
                            <label for="ambient-volume">Ambient Volume:</label>
                            <input type="range" id="ambient-volume" min="0" max="1" step="0.1" value="0.5">
                        </div>
                        <div class="volume-control">
                            <label for="interaction-volume">Interaction Volume:</label>
                            <input type="range" id="interaction-volume" min="0" max="1" step="0.1" value="0.7">
                        </div>
                        <div class="volume-control">
                            <label for="voice-volume">Voice Volume:</label>
                            <input type="range" id="voice-volume" min="0" max="1" step="0.1" value="0.8">
                        </div>
                        <div class="select-wrapper">
                            <label for="ambient-type">Ambient Type:</label>
                            <select id="ambient-type">
                                <option value="cosmic">Cosmic</option>
                                <option value="nature">Nature</option>
                                <option value="meditation">Meditation</option>
                                <option value="urban">Urban</option>
                            </select>
                        </div>
                        <div class="select-wrapper">
                            <label for="voice-type">Voice Type:</label>
                            <select id="voice-type">
                                <option value="default">Default</option>
                                <option value="calm">Calm</option>
                                <option value="energetic">Energetic</option>
                                <option value="thoughtful">Thoughtful</option>
                                <option value="friendly">Friendly</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="panel-section">
                    <h3>Memory</h3>
                    <div class="memory-controls">
                        <button id="clear-short-term-memory">Clear Short-term Memory</button>
                        <button id="clear-all-memory">Clear All Memory</button>
                        <button id="export-memory">Export Memory</button>
                        <button id="import-memory">Import Memory</button>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <footer>
        <p>&copy; 2025 MeAI Project</p>
    </footer>
    
    <!-- Load utility scripts first -->
    <script src="src/utils/event-system.js"></script>
    <script src="src/utils/storage-manager.js"></script>
    <script src="src/utils/user-personalization-system.js"></script>
    
    <!-- Load core components -->
    <script src="src/visual/pixel-animation-system.js"></script>
    <script src="src/visual/dynamic-background-system.js"></script>
    <script src="src/visual/theme-system.js"></script>
    <script src="src/ui/interface-animation-system.js"></script>
    <script src="src/ui/accessibility-system.js"></script>
    <script src="src/audio/multi-layered-ambient-system.js"></script>
    <script src="src/audio/interaction-sound-system.js"></script>
    <script src="src/audio/voice-enhancement-system.js"></script>
    <script src="src/conversation/contextual-memory-system.js"></script>
    <script src="src/conversation/natural-conversation-flow.js"></script>
    <script src="src/conversation/emotional-intelligence-framework.js"></script>
    
    <!-- Load main application script -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize event system
            window.eventSystem = new EventSystem();
            
            // Initialize storage manager
            window.storageManager = new StorageManager();
            
            // Initialize user personalization system
            window.userPersonalizationSystem = new UserPersonalizationSystem();
            
            // Initialize visual components
            window.pixelAnimationSystem = new PixelAnimationSystem();
            window.dynamicBackgroundSystem = new DynamicBackgroundSystem();
            window.themeSystem = new ThemeSystem();
            window.interfaceAnimationSystem = new InterfaceAnimationSystem();
            window.accessibilitySystem = new AccessibilitySystem();
            
            // Initialize audio components
            window.multiLayeredAmbientSystem = new MultiLayeredAmbientSystem();
            window.interactionSoundSystem = new InteractionSoundSystem();
            window.voiceEnhancementSystem = new VoiceEnhancementSystem();
            
            // Initialize conversation components
            window.contextualMemorySystem = new ContextualMemorySystem();
            window.naturalConversationFlow = new NaturalConversationFlow();
            window.emotionalIntelligenceFramework = new EmotionalIntelligenceFramework();
            
            // Set up UI event listeners
            setupUIEventListeners();
            
            // Welcome message
            setTimeout(() => {
                addSystemMessage("Hello! I'm MeAI, your AI assistant. How can I help you today?");
                window.eventSystem.publish('speak-text', { 
                    text: "Hello! I'm MeAI, your AI assistant. How can I help you today?" 
                });
            }, 1000);
        });
        
        function setupUIEventListeners() {
            // Send button
            document.getElementById('send-button').addEventListener('click', () => {
                sendUserMessage();
            });
            
            // User input (Enter key)
            document.getElementById('user-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendUserMessage();
                }
            });
            
            // Voice input button
            document.getElementById('voice-input-button').addEventListener('click', () => {
                startVoiceInput();
            });
            
            // Theme buttons
            document.querySelectorAll('.theme-button').forEach(button => {
                button.addEventListener('click', () => {
                    const theme = button.getAttribute('data-theme');
                    window.eventSystem.publish('theme-change', { theme });
                });
            });
            
            // Accessibility toggles
            document.getElementById('high-contrast-toggle').addEventListener('change', (e) => {
                window.eventSystem.publish('high-contrast-toggle', { enabled: e.target.checked });
            });
            
            document.getElementById('large-text-toggle').addEventListener('change', (e) => {
                window.eventSystem.publish('large-text-toggle', { enabled: e.target.checked });
            });
            
            document.getElementById('reduced-motion-toggle').addEventListener('change', (e) => {
                window.eventSystem.publish('reduced-motion-toggle', { enabled: e.target.checked });
            });
            
            document.getElementById('color-blind-mode').addEventListener('change', (e) => {
                window.eventSystem.publish('color-blind-mode-change', { mode: e.target.value });
            });
            
            // Audio controls
            document.getElementById('ambient-volume').addEventListener('input', (e) => {
                window.eventSystem.publish('ambient-volume-change', { volume: parseFloat(e.target.value) });
            });
            
            document.getElementById('interaction-volume').addEventListener('input', (e) => {
                window.eventSystem.publish('interaction-volume-change', { volume: parseFloat(e.target.value) });
            });
            
            document.getElementById('voice-volume').addEventListener('input', (e) => {
                window.eventSystem.publish('voice-volume-change', { volume: parseFloat(e.target.value) });
            });
            
            document.getElementById('ambient-type').addEventListener('change', (e) => {
                window.eventSystem.publish('ambient-type-change', { type: e.target.value });
            });
            
            document.getElementById('voice-type').addEventListener('change', (e) => {
                window.eventSystem.publish('voice-change', { voice: e.target.value });
            });
            
            // Memory controls
            document.getElementById('clear-short-term-memory').addEventListener('click', () => {
                window.eventSystem.publish('clear-short-term-memory');
                addSystemMessage("Short-term memory has been cleared.");
            });
            
            document.getElementById('clear-all-memory').addEventListener('click', () => {
                window.eventSystem.publish('clear-all-memory');
                addSystemMessage("All memory has been cleared.");
            });
            
            document.getElementById('export-memory').addEventListener('click', () => {
                window.eventSystem.publish('export-memory');
            });
            
            document.getElementById('import-memory').addEventListener('click', () => {
                window.eventSystem.publish('import-memory');
            });
        }
        
        function sendUserMessage() {
            const inputElement = document.getElementById('user-input');
            const message = inputElement.value.trim();
            
            if (message) {
                // Add message to conversation
                addUserMessage(message);
                
                // Clear input
                inputElement.value = '';
                
                // Play sound
                window.eventSystem.publish('play-sound', { category: 'conversation', sound: 'message-sent' });
                
                // Process message
                window.eventSystem.publish('user-message', { text: message });
                
                // Simulate response (in a real implementation, this would come from the AI)
                simulateResponse(message);
            }
        }
        
        function startVoiceInput() {
            // Play sound
            window.eventSystem.publish('play-sound', { category: 'ui', sound: 'voice-start' });
            
            // In a real implementation, this would use the Web Speech API
            // For this demo, we'll simulate voice input
            addSystemMessage("Listening...");
            
            // Simulate voice recognition after a delay
            setTimeout(() => {
                const simulatedVoiceInput = "What can you tell me about yourself?";
                
                // Add recognized text to input
                document.getElementById('user-input').value = simulatedVoiceInput;
                
                // Play sound
                window.eventSystem.publish('play-sound', { category: 'ui', sound: 'voice-end' });
                
                // Send message
                sendUserMessage();
            }, 2000);
        }
        
        function addUserMessage(message) {
            const conversationHistory = document.getElementById('conversation-history');
            const messageElement = document.createElement('div');
            messageElement.className = 'user-message';
            messageElement.textContent = message;
            conversationHistory.appendChild(messageElement);
            
            // Scroll to bottom
            conversationHistory.scrollTop = conversationHistory.scrollHeight;
        }
        
        function addSystemMessage(message) {
            const conversationHistory = document.getElementById('conversation-history');
            const messageElement = document.createElement('div');
            messageElement.className = 'system-message';
            messageElement.textContent = message;
            conversationHistory.appendChild(messageElement);
            
            // Scroll to bottom
            conversationHistory.scrollTop = conversationHistory.scrollHeight;
        }
        
        function simulateResponse(userMessage) {
            // Analyze emotional content
            const emotion = window.emotionalIntelligenceFramework.analyzeEmotion(userMessage);
            
            // Update pixel animation based on emotion
            window.eventSystem.publish('meai-emotional-state-change', { emotion });
            
            // Simulate thinking time based on message complexity
            const thinkingTime = 1000 + (userMessage.length * 20);
            
            // Show thinking indicator
            addSystemMessage("Thinking...");
            
            // Generate response after thinking time
            setTimeout(() => {
                // Remove thinking indicator
                const conversationHistory = document.getElementById('conversation-history');
                conversationHistory.removeChild(conversationHistory.lastChild);
                
                // Generate response based on user message
                let response;
                
                if (userMessage.toLowerCase().includes('hello') || userMessage.toLowerCase().includes('hi')) {
                    response = "Hello! It's nice to chat with you. How can I assist you today?";
                } else if (userMessage.toLowerCase().includes('how are you')) {
                    response = "I'm functioning well, thank you for asking! How are you feeling today?";
                } else if (userMessage.toLowerCase().includes('yourself')) {
                    response = "I'm MeAI, an AI assistant designed to help with various tasks and engage in natural conversations. I have enhanced visual, audio, and conversation capabilities to provide a more immersive and responsive experience.";
                } else if (userMessage.toLowerCase().includes('feature') || userMessage.toLowerCase().includes('can you do')) {
                    response = "I have several features including dynamic visual animations, ambient soundscapes, emotional intelligence, contextual memory, and natural conversation flow. You can customize my appearance with different themes and accessibility options. Would you like to know more about any specific feature?";
                } else {
                    response = "That's an interesting point. I'm designed to have natural conversations and remember context. Is there something specific you'd like to discuss or learn about?";
                }
                
                // Add response to conversation
                addSystemMessage(response);
                
                // Speak response
                window.eventSystem.publish('speak-text', { text: response });
                
                // Play sound
                window.eventSystem.publish('play-sound', { category: 'conversation', sound: 'message-received' });
                
                // Store conversation in memory
                window.eventSystem.publish('memory-store', { 
                    key: `conversation_${Date.now()}`, 
                    value: {
                        user: userMessage,
                        system: response
                    }, 
                    type: 'conversation' 
                });
            }, thinkingTime);
        }
    </script>
</body>
</html>
